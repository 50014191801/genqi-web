<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>GenQi Pro Â· è‰¾ç¸é¦†æ™ºèƒ½æ¥è¯Šç³»ç»Ÿ</title>
  <meta name="description" content="å®¢æˆ·ç—‡çŠ¶å½•å…¥ â†’ è‡ªåŠ¨ç”Ÿæˆè¾©è¯ä¸æ°”æœºåˆ†å±‚å¸ƒç«å»ºè®®ï¼ˆå«å¦‡ç§‘/ç”·æ€§ç§‘/è€å¹´ç—…ç§‘ä¸“é¡¹ï¼‰ â†’ ä¸€é”®å‘é€é—¨åº— WhatsApp æ¥è¯Šã€‚" />
  <meta name="theme-color" content="#0ea5e9" />
  <style>
    :root{
      --bg1:#eef7ff;--bg2:#fff7fb;
      --fg:#0f172a;--muted:#64748b;--line:#e5e7eb;
      --brand:#0ea5e9;--brand-600:#0284c7;
      --card:#ffffff;--shadow:0 10px 30px rgba(2,132,199,.12);
      --radius:16px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;color:var(--fg);
      font:16px/1.6 ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto;
      background:linear-gradient(135deg,var(--bg1),var(--bg2));
    }
    a{color:var(--brand);text-decoration:none}
    .wrap{max-width:980px;margin:0 auto;padding:28px}
    .logo{display:flex;align-items:center;gap:14px;margin-bottom:16px}
    .qi{
      width:56px;height:56px;border-radius:14px;background:#111;color:#fff;display:grid;place-items:center;
      font-weight:700;box-shadow:var(--shadow);
    }
    h1{margin:0;font-size:26px}
    .subtitle{color:var(--muted);margin-top:4px}
    .card{
      background:var(--card);border:1px solid var(--line);border-radius:var(--radius);
      padding:20px;box-shadow:var(--shadow);
    }
    label{font-size:13px;color:#475569}
    input,select,textarea{
      width:100%;padding:10px 12px;border:1px solid var(--line);border-radius:12px;
      outline:none;background:#fff;color:#fg;
    }
    textarea{min-height:88px;resize:vertical}
    input:focus,select:focus,textarea:focus{border-color:var(--brand);box-shadow:0 0 0 3px rgba(14,165,233,.15)}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .full{grid-column:1/-1}
    .btns{display:flex;flex-wrap:wrap;gap:10px;margin-top:16px}
    .btn{
      padding:10px 14px;border-radius:12px;border:1px solid transparent;cursor:pointer;font-weight:600;
      background:var(--brand);color:#fff;
    }
    .btn:hover{background:var(--brand-600)}
    .btn.ghost{background:#fff;color:#111;border-color:var(--line)}
    .success{
      background:#e6f8ee;color:#047857;border:1px solid #a7f3d0;
      padding:14px;border-radius:var(--radius);margin-top:18px;display:none;
    }
    .footer{text-align:center;color:#64748b;font-size:12px;margin-top:24px}
    @media (max-width:760px){ .row{grid-template-columns:1fr} }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="logo">
      <div class="qi">Qi</div>
      <div>
        <h1>GenQi Pro Â· è‰¾ç¸é¦†æ™ºèƒ½æ¥è¯Šç³»ç»Ÿ</h1>
        <div class="subtitle">å®¢æˆ·è¾“å…¥ç—‡çŠ¶ â†’ è‡ªåŠ¨ç”Ÿæˆè¾©è¯ä¸æ°”æœºåˆ†å±‚å¸ƒç«å»ºè®®ï¼ˆå«å¦‡ç§‘/ç”·æ€§ç§‘/è€å¹´ç—…ç§‘ä¸“é¡¹ï¼‰ â†’ ä¸€é”®å‘é€é—¨åº—æ¥è¯Š</div>
      </div>
    </div>

    <div class="card">
      <h3>ğŸ“ å®¢æˆ·ç—‡çŠ¶å½•å…¥è¡¨</h3>

      <div class="full">
        <label>å®¢æˆ·å§“åï¼ˆæˆ–ç¼–å·ï¼‰</label>
        <input id="name" placeholder="ä¾‹ï¼šå¼ å¥³å£« / Z-2025-001" />
      </div>

      <div class="full">
        <label>ä¸»è¯‰ï¼ˆæœ€å›°æ‰°çš„é—®é¢˜ï¼‰</label>
        <input id="chief" placeholder="ä¾‹ï¼šç¡ä¸ç€ã€èƒƒèƒ€ã€æœˆç»ä¸è°ƒã€å¤œå°¿é¢‘ã€è†ç—›â€¦" />
      </div>

      <div class="row">
        <div>
          <label>ç²¾åŠ›ï¼ˆ1-10ï¼‰</label>
          <input id="energy" type="number" min="1" max="10" value="6" />
        </div>
        <div>
          <label>æœ€è¿‘3å¤©ä½“æ„Ÿ</label>
          <select id="feel">
            <option value="">è¯·é€‰æ‹©</option>
            <option>èº«è½»æ¾</option><option>æ˜“ç–²åŠ³</option><option>å¤´é‡</option>
            <option>èƒ¸é—·/èƒŒç´§</option><option>å¿ƒæ‚¸</option><option>è…°é…¸</option>
          </select>
        </div>
      </div>

      <div class="row">
        <div>
          <label>å¤œé—´ç¡çœ ï¼ˆå°æ—¶ï¼‰</label>
          <input id="sleep" type="number" min="3" max="12" value="7" />
        </div>
        <div>
          <label>æƒ…ç»ªå‹åŠ›</label>
          <select id="stress"><option>ä½</option><option selected>ä¸­</option><option>é«˜</option></select>
        </div>
      </div>

      <div class="row">
        <div>
          <label>æ¶ˆåŒ–æƒ…å†µ</label>
          <select id="digestion">
            <option value="">è¯·é€‰æ‹©</option><option>æ­£å¸¸</option><option>è…¹èƒ€</option>
            <option>ä¾¿ç§˜</option><option>è…¹æ³»</option><option>åé…¸/çƒ§å¿ƒ</option>
          </select>
        </div>
        <div>
          <label>æ‰‹è„šæ¸©åº¦</label>
          <select id="limbTemp">
            <option>æ­£å¸¸</option><option>åå†·</option><option>å†·</option><option>åçƒ­</option><option>çƒ­</option>
          </select>
        </div>
      </div>

      <div class="row">
        <div>
          <label>å£æ¸´/é¥®æ°´</label>
          <select id="thirst">
            <option>æ­£å¸¸</option><option>å£å¹²å–œå†·é¥®</option><option>ä¸æ¸´å°‘é¥®</option>
          </select>
        </div>
        <div>
          <label>å¥³æ€§ç»æœŸï¼ˆå¦‚é€‚ç”¨ï¼‰</label>
          <select id="menses">
            <option selected>ä¸é€‚ç”¨/æ­£å¸¸</option><option>ç–¼ç—›</option><option>æå‰</option>
            <option>å»¶å</option><option>é‡å¤š</option><option>é‡å°‘</option><option>é—­ç»</option>
          </select>
        </div>
      </div>

      <div class="full">
        <label>èˆŒè±¡/å’½å–‰/çš®è‚¤ç­‰ï¼ˆå¯é€‰ï¼‰</label>
        <input id="tongue" placeholder="ä¾‹ï¼šèˆŒæ·¡ã€è‹”ç™½åšï¼›èˆŒçº¢è‹”é»„ï¼›ç˜€ç‚¹ï¼›åšè…»â€¦" />
      </div>

      <div class="full">
        <label>å…¶ä»–è¡¥å……ï¼ˆå¯é€‰ï¼‰</label>
        <textarea id="other" placeholder="ä¾‹ï¼šæ›´å¹´æœŸæ½®çƒ­ç›—æ±—ï¼›ç—›ç»ï¼›å¸¦ä¸‹å¼‚å¸¸ï¼›å¤œå°¿é¢‘ï¼›é˜³ç—¿æ—©æ³„ï¼›è†ç—›ï¼›çœ©æ™•è€³é¸£ç­‰â€¦"></textarea>
      </div>

      <div class="btns">
        <button class="btn" id="send">æäº¤è‡³é—¨åº—</button>
        <button class="btn ghost" id="reset">æ¸…ç©º</button>
      </div>

      <div id="success" class="success">
        âœ… ä¿¡æ¯å·²å‘é€è‡³é—¨åº—ï¼Œè¯·ç¨å€™è€å¸ˆè”ç³»æ‚¨ã€‚
      </div>
    </div>

    <div class="footer">
      Â© 2025 GenQi Pro Â· ä¸“ä¸šè‰¾ç¸é¦†æ¥è¯Šç³»ç»Ÿã€‚æ‰€æœ‰å†…å®¹ä»…ä¾›å¥åº·è°ƒç†å‚è€ƒï¼›å‡ºç°ç´§æ€¥ç—‡çŠ¶è¯·ç«‹å³å°±åŒ»ã€‚
    </div>
  </div>

  <!-- ======= è„šæœ¬å¼€å§‹ ======= -->
  <script>
    /* =====================================================
       [è¡Œ 300] åŸºç¡€å¸¸é‡ä¸æŒ‰é’®
       ===================================================== */
    const $ = s => document.querySelector(s);
    const btn = $("#send");
    const resetBtn = $("#reset");
    const notice = $("#success");

    // âš ï¸ ä¿æŒä¸ä½ ç°åœ¨ä¸€è‡´ï¼šWhatsApp & é‚®ä»¶é…ç½®ä¸æ”¹
    const storeEmail = "borneonmoxa@gmail.com"; // å¯ç•™ç©º
    const storeWA    = "60109732328";           // å›½é™…æ ¼å¼ï¼Œæ—  + / 0 / ç©ºæ ¼ / -

    /* =====================================================
       [è¡Œ 320] è¯å‹ä¸­æ–‡æ˜ å°„ & å±•ç¤ºæ ¼å¼åŒ–
       ===================================================== */
    const PATTERN_CN = {
      yangXu: "é˜³è™š", yinXu: "é˜´è™š", qiZhi: "æ°”æ»", shiRe: "æ¹¿çƒ­", piXu: "è„¾è™š",
      tanShi: "ç—°æ¹¿", xueYu: "è¡€ç˜€", qiXueLiangXu: "æ°”è¡€ä¸¤è™š", ganShenLiangXu: "è‚è‚¾ä¸¤è™š",
      weiReShiJi: "èƒƒçƒ­é£Ÿç§¯", "ç»¼åˆ/æœªå®šå‹": "ç»¼åˆ/æœªå®šå‹"
    };
    function cnCode(code){ return PATTERN_CN[code] || code; }
    function formatPattern(mainCode, secondCode){
      if(!mainCode) return PATTERN_CN["ç»¼åˆ/æœªå®šå‹"];
      if(secondCode) return `${cnCode(mainCode)}ï¼ˆå…¼${cnCode(secondCode)}ï¼‰`;
      return cnCode(mainCode);
    }

    /* =====================================================
       [è¡Œ 350] è¯å‹è§„åˆ™åº“ï¼ˆ10 ç±»ï¼‰+ æ°”æœºåˆ†å±‚æ¨¡æ¿
       ===================================================== */
    const RULES = {
      yangXu: { keys:["æ€•å†·","ç•å¯’","æ‰‹è„šå†·","å–œçƒ­","ä¹åŠ›","å°¿æ¸…é•¿","å››è‚¢å‘å‡‰","ç•é£"],
        base:["å…³å…ƒ","å‘½é—¨","æ°”æµ·","è¶³ä¸‰é‡Œ"], plus:["è‚¾ä¿","ä¸­æ"], assist:["éš”å§œç¸ / æ¸©å’Œè‰¾æ¡"], intensity:"ä¸­ç¸", focus:"ä¸‹ç„¦" },
      yinXu: { keys:["ç›—æ±—","å£å¹²","èˆŒçº¢","å¿ƒçƒ¦","å¤±çœ ","å¤œæ±—","äº”å¿ƒçƒ¦çƒ­","æ½®çƒ­"],
        base:["ä¸‰é˜´äº¤","å¤ªæºª","ç¥é—¨"], plus:["æ¶Œæ³‰","ç…§æµ·"], assist:["å‡é‡ç¸ / é—´æ­‡ç¸"], intensity:"æµ…ç¸", focus:"ä¸Šç„¦" },
      qiZhi: { keys:["èƒ¸é—·","èƒ€","å—³æ°”","çƒ¦é—·","æƒ…ç»ª","æ˜“æ€’","å’½å–‰å¼‚ç‰©æ„Ÿ","ä¸¤èƒèƒ€ç—›"],
        base:["è†»ä¸­","ä¸­è„˜","å¤ªå†²"], plus:["æœŸé—¨","è¡Œé—´"], assist:["é¡ºæ°”æ‰‹æ³•é…åˆç¸"], intensity:"ä¸­ç¸", focus:"ä¸Šç„¦" },
      shiRe: { keys:["å£è‹¦","ä¾¿ç§˜","å°ä¾¿é»„","ç—¤ç–®","è‹”é»„è…»","å£å¹²","è…¹èƒ€ç²˜æ»","å¤§ä¾¿å¹²ç»“","ä½“è‡­é‡"],
        base:["é˜´é™µæ³‰","æ›²æ± ","è¶³ä¸‰é‡Œ","ä¸°éš†"], plus:["å†…åº­","åˆè°·"], assist:["ä»¥æ¸…ä¸ºä¸»ï¼ŒçŸ­æ—¶å¤šæ¬¡"], intensity:"æµ…ç¸", focus:"ä¸­ç„¦" },
      piXu: { keys:["é£Ÿå°‘","è…¹èƒ€","ä¹åŠ›","é¢è‰²èé»„","å¤§ä¾¿ç¨€","è…¹æ³»","çº³å·®","å—œç¡","æ˜“ç–²åŠ³"],
        base:["ä¸­è„˜","è¶³ä¸‰é‡Œ","è„¾ä¿"], plus:["æ°”æµ·","ä¸‰é˜´äº¤"], assist:["è½»æŸ”ç•™ç¸ï¼Œæ—¶é—´é€‚ä¸­"], intensity:"ä¸­ç¸", focus:"ä¸­ç„¦" },
      tanShi: { keys:["ç—°å¤š","å’³ç—°","èƒ¸é—·ç—°é¸£","è‹”åšè…»","ä½“å½¢è‚¥èƒ–","å›°é‡","çœ©æ™•ç—°ä¸Šæ‰°"],
        base:["ä¸°éš†","ä¸­è„˜","é˜´é™µæ³‰"], plus:["è‚ºä¿","åˆ—ç¼º"], assist:["åŒ–ç—°ä¸ºä¸»ï¼Œå¯é…åˆèµ°ç½"], intensity:"ä¸­ç¸", focus:"ä¸­ä¸Šç„¦" },
      xueYu: { keys:["åˆºç—›","å›ºå®šç—›","ç—›ç»ç˜€å—","èº«ä¸Šç˜€æ–‘","é¢æš—æ²‰","èˆŒæœ‰ç˜€ç‚¹","èƒ¸ç—¹"],
        base:["è¡€æµ·","è†ˆä¿","ä¸‰é˜´äº¤"], plus:["å¤ªå†²","å†…å…³"], assist:["æ´»è¡€åŒ–ç˜€ï¼Œæ‰‹æ³•é…åˆ"], intensity:"ä¸­ç¸", focus:"ä¸Šä¸­ç„¦" },
      qiXueLiangXu: { keys:["é¢è‰²èé»„","å¿ƒæ‚¸æ°”çŸ­","å¤´æ™•","ä¹åŠ›","çˆªç”²æ·¡ç™½","æœˆç»é‡å°‘"],
        base:["æ°”æµ·","å…³å…ƒ","è¶³ä¸‰é‡Œ","è„¾ä¿"], plus:["è†»ä¸­","ç™¾ä¼š"], assist:["æ¸©è¡¥ä¸ºä¸»ï¼Œå¯é…åˆè‰¾é¥¼"], intensity:"ä¸­ç¸", focus:"ä¸­ä¸‹ç„¦" },
      ganShenLiangXu: { keys:["è…°è†é…¸è½¯","å¤´æ™•è€³é¸£","å¤±çœ å¤šæ¢¦","ç›®å¹²æ¶©","é˜³ç—¿","è„±å‘"],
        base:["è‚ä¿","è‚¾ä¿","å¤ªæºª","ä¸‰é˜´äº¤"], plus:["å…³å…ƒ","å¤ªå†²"], assist:["æ»‹è¡¥è‚è‚¾ï¼Œé‡å®œæ¸è¿›"], intensity:"æµ…-ä¸­ç¸", focus:"ä¸‹ç„¦" },
      weiReShiJi: { keys:["å£æ¸´å–œå†·","å£è‡­","èƒƒè„˜ç¼çƒ­","å¤šé£Ÿæ˜“é¥¥","å¤§ä¾¿å¹²","èˆŒçº¢è‹”é»„","å—³è…åé…¸"],
        base:["å†…åº­","æ¢ä¸˜","ä¸­è„˜","å¤©æ¢"], plus:["åˆè°·","æ›²æ± "], assist:["æ¸…èƒƒæ³„çƒ­ï¼Œæ…æ¸©"], intensity:"æµ…ç¸", focus:"ä¸­ç„¦" }
    };

    // æ°”æœºåˆ†å±‚æ¨¡æ¿ï¼ˆç„¦åŸŸ â†’ è¡¥å……åŸåˆ™ï¼‰
    const QI_LAYERS = {
      "ä¸Šç„¦": { open:["è†»ä¸­","å¤©çª"], descend:["å¤©çª","å†…å…³"], note:"å®£å‘è‚ƒé™ï¼Œæƒ…å¿—è°ƒç•…" },
      "ä¸­ç„¦": { harmonize:["ä¸­è„˜","å¤©æ¢","è„¾ä¿"], move:["å¤ªå†²","åˆè°·"], note:"å¥è¿è„¾èƒƒï¼Œå‡æ¸…é™æµŠ" },
      "ä¸‹ç„¦": { warm:["å…³å…ƒ","ä¸­æ"], root:["å‘½é—¨","è‚¾ä¿"], note:"æ¸©å…»å†²ä»»ï¼ŒåŸ¹è¡¥ä¸‹å…ƒ" },
      "ä¸­ä¸Šç„¦": { open:["è†»ä¸­"], transform:["ä¸°éš†","é˜´é™µæ³‰"], note:"åŒ–ç—°å®½ä¸­ï¼Œå¼€é˜–è°ƒæœº" },
      "ä¸Šä¸­ç„¦": { move:["è†»ä¸­","å¤ªå†²"], blood:["è¡€æµ·","è†ˆä¿"], note:"è¡Œæ°”æ´»è¡€ï¼Œé€šæ»æ­¢ç—›" },
      "ä¸­ä¸‹ç„¦": { tonify:["æ°”æµ·","å…³å…ƒ"], harmonize:["ä¸­è„˜","è„¾ä¿"], note:"è¡¥ç›Šæ°”è¡€ï¼Œç»Ÿæ‘„å‡é™" }
    };

    /* =====================================================
       [è¡Œ 430] ä¸‰å¤§ä¸“é¡¹ï¼šå¦‡ç§‘ / ç”·æ€§ç§‘ / è€å¹´ç—…ç§‘ï¼ˆå åŠ è§„åˆ™ï¼‰
       ===================================================== */
    // å‘½ä¸­ä¸“é¡¹å…³é”®è¯æ—¶ï¼Œé¢å¤–å åŠ åŠ ç‚¹ä¸è¯´æ˜ï¼ˆä¸ä¼šå–ä»£è¯å‹ï¼Œåªæ˜¯â€œåŠ å·åŒ…â€ï¼‰
    const SPECIAL = [
      {
        name: "å¦‡ç§‘ï¼ˆç»æœŸ/å¸¦ä¸‹/æ›´å¹´æœŸï¼‰",
        trigger: /(ç—›ç»|ç»ç—›|æœˆç»ä¸è°ƒ|æå‰|å»¶å|é‡å¤š|é‡å°‘|é—­ç»|å¸¦ä¸‹|æ›´å¹´æœŸ|æ½®çƒ­|ç›—æ±—)/,
        addPoints: ["ä¸‰é˜´äº¤","å…³å…ƒ","å­å®«","ä¸­æ","å¤ªå†²"],
        note: "è°ƒå†²ä»»ã€ç†è‚éƒï¼›è¡Œæ°”æ´»è¡€ä¸æ¸©å…»ç›¸é…ã€‚ç»æœŸå‰§ç—›å¯åŠ è¡€æµ·ï¼›æ›´å¹´æœŸæ½®çƒ­åé˜´è™šè€…é…ŒåŠ å¤ªæºªã€‚"
      },
      {
        name: "ç”·æ€§ç§‘ï¼ˆè‚¾é˜³/å‰åˆ—è…º/æ€§åŠŸèƒ½ï¼‰",
        trigger: /(é˜³ç—¿|æ—©æ³„|ä¸è‚²|å‰åˆ—è…º|å¤œå°¿|å°¿é¢‘|æ€§æ¬²ä½|æ»‘ç²¾)/,
        addPoints: ["å…³å…ƒ","å‘½é—¨","è‚¾ä¿","ä¸­æ","å¤ªæºª","ä¼šé˜´"],
        note: "æ¸©è‚¾å›ºæœ¬ï¼Œä½ä»¥ä¸‹ç„¦å›ºæ‘„ï¼›å°ä¾¿é¢‘æ•°å…¼æ¶©ç—›è€…ï¼Œå¯åŠ ä¸‰é˜´äº¤ä¸æ°´é“ã€‚"
      },
      {
        name: "è€å¹´ç—…ç§‘ï¼ˆç¡çœ /ä¾¿ç§˜/å…³èŠ‚/çœ©æ™•ï¼‰",
        trigger: /(å¤±çœ |å¤šæ¢¦|å¥å¿˜|ä¾¿ç§˜|è†ç—›|å…³èŠ‚|éª¨å…³èŠ‚|çœ©æ™•|è€³é¸£|æ°”çŸ­|ä¹åŠ›|æ­¥æ€ä¸ç¨³)/,
        addPoints: ["ç¥é—¨","å®‰çœ ","ç™¾ä¼š","å¤©æ¢","å¤§è‚ ä¿","è†çœ¼","é˜³é™µæ³‰","é£æ± ","å¤ªå†²"],
        note: "å®ç¥ã€é€šä¾¿ã€èˆ’ç­‹ä¸æ¸…çªå¹¶ä¸¾ï¼›ä¸ªåˆ«æ‚£è€…ä½“è™šä¸è€ä¹…ç¸ï¼Œæ—¶é•¿ä¸å¼ºåº¦å®œä»è½»åˆ°ä¸­ã€‚"
      }
    ];

    /* =====================================================
       [è¡Œ 470] æ‰“åˆ†å¼•æ“ + å¼ºåº¦è‡ªåŠ¨å¾®è°ƒ + ä¸“é¡¹å åŠ 
       ===================================================== */
    function scoreAndSuggest(v){
      // 1) æ–‡æœ¬æ± 
      const raw = [v.chief, v.feel, v.digestion, v.limbTemp, v.thirst, v.tongue, v.other, v.menses].join(" ");
      const text = (raw || "").toLowerCase().replace(/\u00A0/g, " ");

      // 2) ç´§æ€¥ç¦ç¸ï¼ˆå‡ºç°å³è¿”å›ï¼‰
      const redFlags = ["èƒ¸ç—›","å‘¼å¸å›°éš¾","é«˜çƒ­","æ™•å¥","ä¸¥é‡å‡ºè¡€"];
      for (const rf of redFlags){
        if (text.includes(rf.toLowerCase())){
          return {
            main:null, second:null, mixed:false,
            primary:[], secondary:[], assist:[],
            intensity:"ç¦ç¸", timePerPointMin:0, sessionMinutes:0,
            frequency:"ç«‹å³å°±åŒ»ï¼Œæš‚åœç¸ç–—", qiLayerNote:"â€”â€”",
            note:`å‡ºç°ç´§æ€¥ä¿¡å·ï¼ˆ${rf}ï¼‰ï¼Œè¯·ç¬¬ä¸€æ—¶é—´å°±åŒ»ã€‚`,
            specials:[]
          };
        }
      }

      // 3) è¯å‹æ‰“åˆ†
      const scores = {};
      Object.keys(RULES).forEach(key=>{
        let s = 0; const r = RULES[key];
        r.keys.forEach(kw=>{ if (text.includes(kw.toLowerCase())) s += 1; });

        // ç»“æ„åŒ–åŠ æƒ
        if (key==="yangXu" && /å†·|ç•å¯’|åå†·/.test(v.limbTemp||"")) s += 1;
        if (key==="yinXu"  && /å£å¹²|ç›—æ±—|æ½®çƒ­/.test((v.thirst||"") + " " + (v.other||""))) s += 1;
        if (key==="qiZhi"  && /(èƒ¸é—·|çƒ¦é—·|æ˜“æ€’)/.test(v.feel||"")) s += 1;
        if (key==="shiRe"  && /(å£è‹¦|è‹”é»„|å°ä¾¿é»„)/.test((v.tongue||"") + " " + (v.digestion||""))) s += 1;
        if (key==="piXu"   && /(è…¹èƒ€|é£Ÿå°‘|å¤§ä¾¿ç¨€|è…¹æ³»)/.test(v.digestion||"")) s += 1;
        if (key==="tanShi" && /(è‹”åšè…»|ç—°|å›°é‡)/.test((v.tongue||"") + " " + (v.feel||""))) s += 1;
        if (key==="xueYu"  && /(åˆºç—›|å›ºå®šç—›|ç˜€|ç˜€ç‚¹)/.test((v.chief||"") + " " + (v.tongue||""))) s += 1;
        if (key==="qiXueLiangXu" && /(é¢è‰²èé»„|å¤´æ™•|é‡å°‘)/.test((v.chief||"") + " " + (v.menses||""))) s += 1;
        if (key==="ganShenLiangXu" && /(è…°è†é…¸è½¯|è€³é¸£|è„±å‘|å¤šæ¢¦)/.test((v.other||"") + " " + (v.feel||""))) s += 1;
        if (key==="weiReShiJi" && /(å£è‡­|åé…¸|ç¼çƒ­|å¤§ä¾¿å¹²)/.test((v.chief||"") + " " + (v.digestion||""))) s += 1;

        scores[key] = s;
      });

      const sorted = Object.entries(scores).sort((a,b)=>b[1]-a[1]);
      const [top, second] = [sorted[0], sorted[1]];

      // 4) åŸºç¡€å»ºè®®ï¼ˆè‹¥æ— æ˜æ˜¾è¯å‹ï¼‰
      if (!top || top[1]===0){
        const L = QI_LAYERS["ä¸­ç„¦"];
        return {
          main:null, second:null, mixed:false,
          primary:["ä¸­è„˜","å…³å…ƒ","è¶³ä¸‰é‡Œ"], secondary:["è„¾ä¿"], assist:["åŸºç¡€å¸ƒé˜µï¼Œ30åˆ†é’Ÿåå¤æŸ¥"],
          intensity:"ä¸­ç¸", timePerPointMin:8, sessionMinutes:25,
          frequency:"æ¯å‘¨ 2-3 æ¬¡ï¼Œ10-12 æ¬¡ä¸ºä¸€ç–—ç¨‹", qiLayerNote:L.note,
          note:"æ— æ˜æ˜¾å•ä¸€è¯å‹ï¼Œå»ºè®®å…ˆåšä¸­ç„¦ä¸ä¸‹ç„¦åŸºç¡€ä½ï¼Œè§‚å¯Ÿå†è°ƒã€‚",
          specials:matchSpecials(text)
        };
      }

      const mainKey = top[0];
      const secondKey = (second && (top[1]-second[1] <= 1)) ? second[0] : null;
      const main = RULES[mainKey];

      // 5) å¼ºåº¦æŒ‰ç²¾åŠ›/å‹åŠ›å¾®è°ƒ
      let intensity = main.intensity; // å¯èƒ½æ˜¯â€œæµ…-ä¸­ç¸â€
      const energy = Number(v.energy || 6);
      const stress = String(v.stress || "ä¸­");
      if (intensity.includes("æµ…-ä¸­")) intensity = (energy>=7 ? "ä¸­ç¸" : "æµ…ç¸");
      if (energy <=4 && intensity==="ä¸­ç¸") intensity = "æµ…ç¸";
      if (energy >=9 && intensity==="ä¸­ç¸" && stress==="ä½") intensity = "æ·±ç¸";

      const TIME = { "æµ…ç¸":{per:6,session:18}, "ä¸­ç¸":{per:8,session:25}, "æ·±ç¸":{per:10,session:30} };
      const t = TIME[intensity] || TIME["ä¸­ç¸"];

      // 6) æ°”æœºåˆ†å±‚æç¤º
      const layerKey = main.focus || "ä¸­ç„¦";
      const layer = QI_LAYERS[layerKey] || { note:"è°ƒå’Œæ°”æœº" };

      // 7) ä¸‰å¤§ä¸“é¡¹å åŠ 
      const specials = matchSpecials(text);

      // 8) åˆå¹¶â€œä¸“é¡¹åŠ ç‚¹â€ï¼ˆä¸è¦†ç›–ä¸»é˜µï¼Œåªå åŠ ï¼‰
      const addFromSpecials = specials.flatMap(s => s.addPoints);
      const mergedPrimary = Array.from(new Set([...main.base]));
      const mergedSecondary = Array.from(new Set([...main.plus]));
      const mergedAssist = Array.from(new Set([...main.assist, ...addFromSpecials]));

      return {
        main:mainKey, second:secondKey, mixed:!!secondKey,
        primary:mergedPrimary, secondary:mergedSecondary, assist:mergedAssist,
        intensity:intensity, timePerPointMin:t.per, sessionMinutes:t.session,
        frequency:"æ¯å‘¨ 2-3 æ¬¡ï¼Œ10-12 æ¬¡ä¸ºä¸€ç–—ç¨‹ï¼›ç¼“è§£åç»´æŒ 1 æ¬¡/å‘¨",
        qiLayerNote: layer.note,
        note: secondKey ? `ä¸»ï¼š${cnCode(mainKey)}ï¼›å…¼ï¼š${cnCode(secondKey)}ã€‚å¯å…¼é¡¾å…¼è¯è¦ç‚¹ã€‚`
                        : `ä»¥ ${cnCode(mainKey)} ä¸ºä¸»è¿›è¡Œç¸ç–—ã€‚`,
        specials
      };
    }

    // ä¸“é¡¹åŒ¹é…å‡½æ•°
    function matchSpecials(text){
      const out = [];
      for (const sp of SPECIAL){
        if (sp.trigger.test(text)){
          out.push({ name: sp.name, addPoints: sp.addPoints, note: sp.note });
        }
      }
      return out;
    }

    /* =====================================================
       [è¡Œ 560] ç»„è£…å‘é€æ–‡æœ¬ï¼ˆå½»åº•ä¸­æ–‡åŒ– + ä¸“é¡¹è¯´æ˜ï¼‰
       ===================================================== */
    function buildMessage(){
      const v = {
        name:   $("#name").value.trim(),
        chief:  $("#chief").value.trim(),
        energy: $("#energy").value.trim(),
        feel:   $("#feel").value,
        sleep:  $("#sleep").value,
        stress: $("#stress").value,
        digestion: $("#digestion").value,
        limbTemp: $("#limbTemp").value,
        thirst:  $("#thirst").value,
        menses:  $("#menses").value,
        tongue:  $("#tongue").value.trim(),
        other:   $("#other").value.trim()
      };

      const tip = scoreAndSuggest(v);
      const zhPattern = formatPattern(tip.main, tip.second);

      // ä¸“é¡¹è¯´æ˜æ‹¼æ¥
      let specialTxt = "";
      if (tip.specials && tip.specials.length){
        const rows = tip.specials.map(s => `â€¢ ${s.name}ï¼šåŠ ç‚¹ ${s.addPoints.join("ã€")}ï¼›è¦ç‚¹ï¼š${s.note}`);
        specialTxt = `\nä¸“é¡¹å åŠ ï¼š\n${rows.join("\n")}`;
      }

      const sys = `ã€ç³»ç»Ÿå»ºè®®ã€‘
è¯å‹ï¼š${zhPattern}
ç¸æ³•ï¼š${tip.intensity}
åŸºç¡€ä½ï¼š${(tip.primary && tip.primary.length) ? tip.primary.join("ã€") : "â€”"}
å¼ºåŒ–ä½ï¼š${(tip.secondary && tip.secondary.length) ? tip.secondary.join("ã€") : "â€”"}
è¾…åŠ©ï¼š${(tip.assist && tip.assist.length) ? tip.assist.join("ã€") : "â€”"}
æ—¶é•¿ï¼šæ¯ç©´çº¦ ${tip.timePerPointMin} åˆ†é’Ÿï¼›å•æ¬¡ ${tip.sessionMinutes} åˆ†é’Ÿ
é¢‘æ¬¡ï¼š${tip.frequency}
æ°”æœºåˆ†å±‚ï¼š${tip.qiLayerNote}
è¯´æ˜ï¼š${tip.note}${specialTxt}`;

      return `
å®¢æˆ·ä¿¡æ¯ï¼š
å§“å/ç¼–å·ï¼š${v.name || "æœªå¡«"}
ä¸»è¯‰ï¼š${v.chief || "æœªå¡«"}
ç²¾åŠ›ï¼š${v.energy || "â€”"}/10ï¼›ç¡çœ ï¼š${v.sleep || "â€”"}hï¼›å‹åŠ›ï¼š${v.stress || "â€”"}
ä½“æ„Ÿï¼š${v.feel || "â€”"}ï¼›æ¶ˆåŒ–ï¼š${v.digestion || "â€”"}
æ‰‹è„šæ¸©ï¼š${v.limbTemp || "â€”"}ï¼›é¥®æ°´ï¼š${v.thirst || "â€”"}ï¼›ç»æœŸï¼š${v.menses || "â€”"}
èˆŒ/çš®è‚¤ç­‰ï¼š${v.tongue || "â€”"}
è¡¥å……ï¼š${v.other || "â€”"}

${sys}
`.trim();
    }
/* =====================================================
       [è¡Œ 410] èµ·ç«-å¸ƒç«-æ”¶ç« æµç¨‹æ¨¡æ¿ï¼ˆéšç„¦åŸŸä¸å¼ºåº¦å¾®è°ƒï¼‰
       ===================================================== */
    const FIRE_FLOW = {
      "ä¸Šç„¦":  { start:["ç™¾ä¼š","è†»ä¸­"],        main:["ä¸­è„˜","å¤ªå†²"],            close:["å¤ªæºª","æ¶Œæ³‰"] },
      "ä¸­ç„¦":  { start:["ä¸­è„˜","å¤©æ¢"],        main:["å…³å…ƒ","è¶³ä¸‰é‡Œ","è„¾ä¿"],    close:["æ¶Œæ³‰","å¤ªæºª"] },
      "ä¸‹ç„¦":  { start:["å…³å…ƒ","æ°”æµ·"],        main:["å‘½é—¨","è‚¾ä¿","ä¸­æ"],      close:["å¤ªæºª","æ¶Œæ³‰"] },
      "ä¸­ä¸Šç„¦":{ start:["è†»ä¸­"],              main:["ä¸°éš†","é˜´é™µæ³‰","ä¸­è„˜"],    close:["å†…å…³","å¤ªæºª"] },
      "ä¸Šä¸­ç„¦":{ start:["è†»ä¸­","å¤ªå†²"],        main:["è¡€æµ·","è†ˆä¿"],            close:["å†…å…³","æ¶Œæ³‰"] },
      "ä¸­ä¸‹ç„¦":{ start:["ä¸­è„˜","å…³å…ƒ"],        main:["æ°”æµ·","è¶³ä¸‰é‡Œ","è„¾ä¿"],    close:["å¤ªæºª","å…³å…ƒ"] }
    };

    function fireFlowBy(tip){
      // é€‰æ‹©ç„¦åŸŸæ¨¡æ¿
      const layerKey = tip?.qiLayerNote?.includes("ä¸Š") && !tip?.qiLayerNote?.includes("ä¸‹") ? "ä¸Šç„¦"
                    : tip?.qiLayerNote?.includes("ä¸‹") && !tip?.qiLayerNote?.includes("ä¸Š") ? "ä¸‹ç„¦"
                    : tip?.qiLayerNote?.includes("ä¸Šä¸­") ? "ä¸Šä¸­ç„¦"
                    : tip?.qiLayerNote?.includes("ä¸­ä¸Š") ? "ä¸­ä¸Šç„¦"
                    : tip?.qiLayerNote?.includes("ä¸­ä¸‹") ? "ä¸­ä¸‹ç„¦"
                    : "ä¸­ç„¦";
      const tpl = FIRE_FLOW[layerKey] || FIRE_FLOW["ä¸­ç„¦"];

      // å¼ºåº¦â†’åˆ†æ®µæ—¶é•¿å¾®è°ƒ
      const I = tip.intensity || "ä¸­ç¸";
      const per = (I==="æµ…ç¸") ? {start:5, main:6, close:4}
               : (I==="æ·±ç¸") ? {start:6, main:10, close:5}
               :                 {start:5, main:8,  close:4};

      return {
        start: tpl.start, startMin: per.start,
        main:  tpl.main.length ? tpl.main : (tip.primary || []), mainMin: per.main,
        close: tpl.close, closeMin: per.close
      };
    }
  // =====================================================
// å‘é€ä¸æ¸…ç©ºï¼ˆWhatsApp å‘é€ï¼‰
// =====================================================
btn.addEventListener("click", () => {
  const msg = buildMessage(); // åœ¨ buildMessage é‡Œå®Œæˆè¾©è¯ + æ‹¼è£…
   const tip  = scoreAndSuggest(v);    // ä¸“ä¸šè¾©è¯
  const zhPattern = cn(tip.pattern);  // è‹±æ–‡æšä¸¾è½¬ä¸­æ–‡
  const flow = fireFlowBy(tip);       // èµ·ç«/å¸ƒç«/æ”¶ç«

  const sys = `ã€ç³»ç»Ÿå»ºè®®ã€‘
è¯å‹ï¼š${zhPattern}
ç¸æ³•ï¼š${tip.intensity}
åŸºç¡€ä½ï¼š${(tip.primary && tip.primary.length) ? tip.primary.join("ã€") : "â€”"}
å¼ºåŒ–ä½ï¼š${(tip.secondary && tip.secondary.length) ? tip.secondary.join("ã€") : "â€”"}
è¾…åŠ©ï¼š${(tip.assist && tip.assist.length) ? tip.assist.join("ã€") : "â€”"}
æ—¶é•¿ï¼šæ¯ç©´çº¦ ${tip.timePerPointMin} åˆ†é’Ÿï¼›å•æ¬¡ ${tip.sessionMinutes} åˆ†é’Ÿ
é¢‘æ¬¡ï¼š${tip.frequency}
æ°”æœºåˆ†å±‚ï¼š${tip.qiLayerNote}
â€”â€” èµ·ç« Â· å¸ƒç« Â· æ”¶ç« â€”â€”
èµ·ç«ï¼ˆå¼€é—¨å¼•é˜³ï¼‰ï¼š${flow.start.join("ã€")}ï¼ˆæ¯ç©´çº¦ ${flow.startMin} åˆ†ï¼‰
å¸ƒç«ï¼ˆä¸»æˆ˜ä½ï¼‰ï¼š${flow.main.join("ã€")}ï¼ˆæ¯ç©´çº¦ ${flow.mainMin} åˆ†ï¼‰
æ”¶ç«ï¼ˆå½’æ ¹å›ºæ‘„ï¼‰ï¼š${flow.close.join("ã€")}ï¼ˆæ¯ç©´çº¦ ${flow.closeMin} åˆ†ï¼‰
è¯´æ˜ï¼š${tip.note}` +
  ((tip.specials && tip.specials.length)
    ? `\nä¸“é¡¹å åŠ ï¼š\n${tip.specials.map(s => `â€¢ ${s.name}ï¼šåŠ ç‚¹ ${s.addPoints.join("ã€")}ï¼›è¦ç‚¹ï¼š${s.note}`).join("\n")}`
    : "");
    resetBtn.addEventListener("click", () => {
      document.querySelectorAll("input,select,textarea").forEach(el => {
        if (el.id === "energy") el.value = 6;
        else if (el.id === "sleep") el.value = 7;
        else if (el.tagName === "SELECT") el.selectedIndex = 0;
        else el.value = "";
      });
      notice.style.display = "none";
    });
  </script>
  <!-- ======= è„šæœ¬ç»“æŸ ======= -->
</body>
</html>
