<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GenQi Pro · 艾灸馆智能接诊系统</title>
  <meta name="description" content="店长一键录入，自动发送门店后台，店内即时接诊；支持轻症问诊、记录与回访。" />
  <meta name="theme-color" content="#0ea5e9" />
  <style>
    :root{
      --bg1:#eef7ff;--bg2:#fff7fb;
      --fg:#0f172a;--muted:#64748b;--line:#e5e7eb;
      --brand:#0ea5e9;--brand-600:#0284c7;
      --card:#ffffff;--shadow:0 10px 30px rgba(2,132,199,.12);
      --radius:18px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;color:var(--fg);
      font:16px/1.6 ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto;
      background:linear-gradient(135deg,var(--bg1),var(--bg2));
    }
    a{color:var(--brand);text-decoration:none}
    .wrap{max-width:960px;margin:0 auto;padding:28px}
    .logo{display:flex;align-items:center;gap:14px;margin-bottom:16px}
    .qi{
      width:56px;height:56px;border-radius:14px;background:#111;color:#fff;display:grid;place-items:center;
      font-weight:700;box-shadow:var(--shadow);
    }
    h1{margin:0;font-size:26px}
    .subtitle{color:var(--muted);margin-top:4px}
    .card{
      background:var(--card);border:1px solid var(--line);border-radius:var(--radius);
      padding:20px;box-shadow:var(--shadow);
    }
    label{font-size:13px;color:#475569}
    input,select,textarea{
      width:100%;padding:10px 12px;border:1px solid var(--line);border-radius:12px;
      outline:none;background:#fff;color:var(--fg);
    }
    textarea{min-height:80px;resize:vertical}
    input:focus,select:focus,textarea:focus{border-color:var(--brand);box-shadow:0 0 0 3px rgba(14,165,233,.15)}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .full{grid-column:1/-1}
    .btns{display:flex;flex-wrap:wrap;gap:10px;margin-top:16px}
    .btn{
      padding:10px 14px;border-radius:12px;border:1px solid transparent;cursor:pointer;font-weight:600;
      background:var(--brand);color:#fff;
    }
    .btn:hover{background:var(--brand-600)}
    .btn.ghost{background:#fff;color:#111;border-color:var(--line)}
    .success{
      background:#e6f8ee;color:#047857;border:1px solid #a7f3d0;
      padding:14px;border-radius:var(--radius);margin-top:18px;display:none;
    }
    .footer{text-align:center;color:#64748b;font-size:12px;margin-top:24px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="logo">
      <div class="qi">Qi</div>
      <div>
        <h1>GenQi Pro · 光疗馆智能接诊系统</h1>
        <div class="subtitle">客户输入症状 → 自动发送门店后台 → 店内即时接诊</div>
      </div>
    </div>

    <div class="card">
      <h3>📝 客户基础情况录入表</h3>

      <div class="full">
        <label>客户姓名（或编号）</label>
        <input id="name" placeholder="例：张女士 / Z-2025-001" />
      </div>

      <div class="full">
        <label>主诉（最困扰的问题）</label>
        <input id="chief" placeholder="例：睡不着、胃胀、月经不调…" />
      </div>

      <div class="row">
        <div>
          <label>精力（1-10）</label>
          <input id="energy" type="number" min="1" max="10" value="6" />
        </div>
        <div>
          <label>最近3天体感</label>
          <select id="feel">
            <option value="">请选择</option>
            <option>身轻松</option><option>易疲劳</option><option>头重</option>
            <option>胸闷/背紧</option><option>心悸</option><option>腰酸</option>
          </select>
        </div>
      </div>

      <div class="row">
        <div>
          <label>夜间睡眠（小时）</label>
          <input id="sleep" type="number" min="3" max="12" value="7" />
        </div>
        <div>
          <label>情绪压力</label>
          <select id="stress"><option>低</option><option selected>中</option><option>高</option></select>
        </div>
      </div>

      <div class="row">
        <div>
          <label>消化情况</label>
          <select id="digestion">
            <option value="">请选择</option><option>正常</option><option>腹胀</option>
            <option>便秘</option><option>腹泻</option><option>反酸/烧心</option>
          </select>
        </div>
        <div>
          <label>手脚温度</label>
          <select id="limbTemp">
            <option>正常</option><option>偏冷</option><option>冷</option><option>偏热</option><option>热</option>
          </select>
        </div>
      </div>

      <div class="row">
        <div>
          <label>口渴/饮水</label>
          <select id="thirst">
            <option>正常</option><option>口干喜冷饮</option><option>不渴少饮</option>
          </select>
        </div>
        <div>
          <label>女性经期（如适用）</label>
          <select id="menses">
            <option selected>不适用/正常</option><option>疼痛</option><option>提前</option>
            <option>延后</option><option>量多</option><option>量少</option>
          </select>
        </div>
      </div>

      <div class="full">
        <label>舌象/咽喉/皮肤等（可选）</label>
        <input id="tongue" placeholder="例：舌淡、苔白厚；咽干、口苦…" />
      </div>

      <div class="full">
        <label>其他补充（可选）</label>
        <textarea id="other" placeholder="任何有助判断的信息…"></textarea>
      </div>

      <div class="btns">
        <button class="btn" id="send">提交至门店</button>
        <button class="btn ghost" id="reset">清空</button>
      </div>

      <div id="success" class="success">
        ✅ 信息已发送至门店。
      </div>
    </div>

    <div class="footer">
      © 2025 GenQi Pro · 专业光疗馆智能评估系统。所有内容仅供健康调理参考。
    </div>
  </div>

  <script>
   // 汉化证型名
function cn(p){ 
  const map={yangXu:'阳虚', yinXu:'阴虚', qiZhi:'气滞', shiRe:'湿热', piXu:'脾虚', '综合/未定型':'综合/未定型'};
  return map[p] || p;
}

// 更专业的证型打分与布火建议
function suggestPoints(v) {
  const patterns = {
    yangXu: {  // 阳虚
      keys: ["怕冷","手脚冷","畏寒","喜热","四肢乏力","小便清长"],
      primary: ["关元","命门","气海","足三里"],
      secondary: ["肾俞","中极"],
      assist: ["隔姜灸 / 艾条温和灸"],
      defaultIntensity: "中灸"
    },
    yinXu: { // 阴虚
      keys: ["盗汗","口干","舌红","失眠","心烦","夜汗"],
      primary: ["三阴交","太溪","神门"],
      secondary: ["涌泉","照海"],
      assist: ["减量灸 / 间歇灸"], 
      defaultIntensity: "浅灸"
    },
    qiZhi: { // 气滞
      keys: ["胸闷","胀","嗳气","烦闷","情绪","易怒"],
      primary: ["膻中","中脘","太冲"],
      secondary: ["期门","行间"],
      assist: ["顺气手法配合灸"], 
      defaultIntensity: "中灸"
    },
    shiRe: { // 湿热
      keys: ["口苦","便秘","小便黄","痤疮","苔黄腻","口干"],
      primary: ["阴陵泉","曲池","足三里","丰隆"],
      secondary: ["内庭","合谷"],
      assist: ["清法为主，短时多次"], 
      defaultIntensity: "浅灸"
    },
    piXu: { // 脾虚
      keys: ["食少","腹胀","乏力","面色萎黄","大便稀"],
      primary: ["中脘","足三里","脾俞"],
      secondary: ["气海","三阳络"],
      assist: ["轻柔留灸，时间适中"], 
      defaultIntensity: "中灸"
    }
  };

  const text = `${v.chief} ${v.feel} ${v.digestion} ${v.limbTemp} ${v.thirst} ${v.tongue} ${v.other} ${v.menses}`.toLowerCase();

  // 打分
  const scores = {};
  for (const k in patterns) {
    let s = 0;
    for (const kw of patterns[k].keys) {
      if (text.indexOf(kw.toLowerCase()) !== -1) s += 1;
    }
    scores[k] = s;
  }

  // 排序
  const arr = Object.entries(scores).sort((a,b)=>b[1]-a[1]);
  const top = arr[0]; 
  const sec = arr[1];

  // 紧急禁灸信号
  const redFlags = ["胸痛","呼吸困难","高热","晕厥","严重出血"];
  for (const rf of redFlags) if (text.indexOf(rf) !== -1) {
    return {
      pattern:"综合/未定型",
      primary:[], secondary:[], assist:[],
      intensity:"禁灸",
      note:`出现紧急信号（${rf}），请立即就医，暂停灸疗。`
    };
  }

  if (!top || top[1] === 0) {
    return {
      pattern:"综合/未定型",
      primary:["中脘","关元","足三里"],
      secondary:[],
      assist:["基础布阵，30分钟后复查自感再调整"],
      intensity:"中灸",
      note:"无明显单一证型，先做基础阵位。"
    };
  }

  const main = patterns[top[0]];
  const mixed = sec && (top[1]-sec[1] <= 1);
  return {
    pattern: mixed ? `${top[0]}（兼证可能）` : top[0],
    primary: main.primary,
    secondary: main.secondary,
    assist: main.assist,
    intensity: main.defaultIntensity,
    note: mixed ? `与 ${sec[0]} 兼证概率较高，可兼顾其要点。` : `以 ${top[0]} 为主进行灸疗。`
  };
}


    const $ = s => document.querySelector(s);
    const btn = $("#send");
    const resetBtn = $("#reset");
    const notice = $("#success");

    // 你的门店联系方式（✅ WhatsApp 必须用国际格式：国家码+去掉前导0）
    const storeEmail = "borneonmoxa@gmail.com";
    const storeWA = "60109732328"; // 

    function suggestPoints(v) {
  // 1) 关键词库（可后期继续扩充）
  const patterns = {
    yangXu: {  // 阳虚
      keys: ["怕冷","手脚冷","畏寒","喜热","四肢乏力","小便清长"],
      primary: ["关元","命门","气海","足三里"],
      secondary: ["肾俞","中极"],
      assist: ["温补艾法：隔姜灸/艾条温和灸"],
      defaultIntensity: "中灸" // 浅灸/中灸/深灸
    },
    yinXu: { // 阴虚
      keys: ["盗汗","口干","舌红","失眠","心烦","夜汗"],
      primary: ["三阴交","太溪","神门"],
      secondary: ["涌泉","照海"],
      assist: ["间歇灸/减量灸"], 
      defaultIntensity: "浅灸"
    },
    qiZhi: { // 气滞
      keys: ["胸闷","胀","嗳气","烦闷","情绪抑郁","易怒"],
      primary: ["膻中","中脘","太冲"],
      secondary: ["期门","行间"],
      assist: ["顺气手法配合灸"], 
      defaultIntensity: "中灸"
    },
    shiRe: { // 湿热
      keys: ["口苦","便秘","小便黄","痤疮","舌苔黄腻","口干"],
      primary: ["阴陵泉","曲池","足三里","丰隆"],
      secondary: ["内庭","合谷"],
      assist: ["清法配合短时频次"], 
      defaultIntensity: "浅灸"
    },
    piXu: { // 脾虚
      keys: ["食少","腹胀","乏力","面色萎黄","大便稀"],
      primary: ["中脘","足三里","脾俞"],
      secondary: ["气海","三阳络"],
      assist: ["轻柔灸/留灸时间短"], 
      defaultIntensity: "中灸"
    }
  };

  // 2) 创建一个干净的文本用于匹配
  const text = `${v.chief} ${v.feel} ${v.digestion} ${v.limbTemp} ${v.thirst} ${v.tongue} ${v.other} ${v.menses}`.toLowerCase();

  // 3) 逐证型打分（关键词出现次数）
  const scores = {};
  for (const key in patterns) {
    let s = 0;
    for (const k of patterns[key].keys) {
      // 简单匹配：如果症状包含该关键词则+1
      if (text.indexOf(k.toLowerCase()) !== -1) s += 1;
    }
    scores[key] = s;
  }

  // 4) 归一化与排序
  const entries = Object.entries(scores).sort((a,b)=>b[1]-a[1]);
  const top = entries[0]; // [patternKey, score]
  const second = entries[1];

  // 5) 构建建议（主证 + 备证）
  const suggestions = [];
  if (top[1] === 0) {
    // 没有明显命中任何单一证型 -> 综合布阵
    return {
      pattern: "综合/未定型",
      score: 0,
      primary: ["中脘","关元","足三里"],
      secondary: [],
      assist: ["以基础布阵为主，短疗程观察；若舌红/口苦考虑偏阴虚/湿热方向"],
      intensity: "中灸",
      note: "无明显单一证型，建议先做基础布阵并记录反馈30分钟后调整。"
    };
  }

  const mainPattern = top[0];
  const mainInfo = patterns[mainPattern];
  // 如果第二高与最高接近（比如差 <=1），提示兼证
  const isMixed = second && (top[1] - second[1] <= 1);

  const out = {
    pattern: mainPattern + (isMixed ? "（可能夹杂其他证）": ""),
    score: top[1],
    primary: mainInfo.primary,
    secondary: mainInfo.secondary,
    assist: mainInfo.assist,
    intensity: mainInfo.defaultIntensity,
    note: isMixed ? `与${second[0]}并证可能性较高，临床上可酌情同时照顾兼证要点。` : `建议按${mainPattern}为主进行灸疗。`
  };

  // 6) 基于个别危险信号调整：若出现“胸痛/呼吸困难/高热/晕厥”等应立即提示就医，不建议灸
  const redFlags = ["胸痛","呼吸困难","高热","晕厥","严重出血"];
  for (const rf of redFlags) if (text.indexOf(rf) !== -1) {
    out.note = "出现紧急信号（"+rf+"），请立即就医，避免在门店继续灸治。";
    out.primary = [];
    out.secondary = [];
    out.assist = [];
    out.intensity = "禁灸";
    return out;
  }
    return out;
}  
    const tip = suggestPoints(v);

 function buildMessage(){
  const v = {
    name: $("#name").value.trim(),
    chief: $("#chief").value.trim(),
    energy: $("#energy").value.trim(),
    feel: $("#feel").value,
    sleep: $("#sleep").value,
    stress: $("#stress").value,
    digestion: $("#digestion").value,
    limbTemp: $("#limbTemp").value,
    thirst: $("#thirst").value,
    menses: $("#menses").value,
    tongue: $("#tongue").value.trim(),
    other: $("#other").value.trim()
  };

  // 这里调用专业辩证
  const tipObj = suggestPoints(v);

  const sys =
`【系统建议】
证型：${cn(tipObj.pattern)}
灸法：${tipObj.intensity}
基础位：${(tipObj.primary && tipObj.primary.length)? tipObj.primary.join("、") : "—"}
强化位：${(tipObj.secondary && tipObj.secondary.length)? tipObj.secondary.join("、") : "—"}
辅助：${(tipObj.assist && tipObj.assist.length)? tipObj.assist.join("、") : "—"}
说明：${tipObj.note}`;

  return `
客户信息：
姓名/编号：${v.name || "未填"}
主诉：${v.chief || "未填"}
精力：${v.energy || "—"}/10；睡眠：${v.sleep || "—"}h；压力：${v.stress || "—"}
体感：${v.feel || "—"}；消化：${v.digestion || "—"}
手脚温：${v.limbTemp || "—"}；饮水：${v.thirst || "—"}；经期：${v.menses || "—"}
舌/皮肤等：${v.tongue || "—"}
补充：${v.other || "—"}

${sys}
`.trim();
}

    btn.addEventListener("click", ()=>{
      const msg = buildMessage();
      const subject = encodeURIComponent("新客户预约 - GenQi Pro");
      const body = encodeURIComponent(msg);
      const mailto = `mailto:${storeEmail}?subject=${subject}&body=${body}`;
      const wa = `https://wa.me/${storeWA}?text=${body}`;

      // 默认打开 WhatsApp 发送
      window.open(wa, "_blank");
      notice.style.display = "block";
      // 作为备份，再打开邮件
      setTimeout(()=>{ window.open(mailto, "_blank"); }, 1000);
    });

    resetBtn.addEventListener("click", ()=>{
      document.querySelectorAll("input,select,textarea").forEach(el=>{
        if(el.id==="energy") el.value=6;
        else if(el.id==="sleep") el.value=7;
        else if(el.tagName==="SELECT") el.selectedIndex=0;
        else el.value="";
      });
      notice.style.display="none";
    });
  </script>
</body>
</html>
